<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NEMCLLYPB6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-NEMCLLYPB6');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Checkout - Realms to Riches</title>
    <meta name="description" content="Complete your secure payment for products and services from Realms to Riches. Fast, easy, and secure checkout process.">
    <meta name="keywords" content="secure checkout, payment, online payment, digital products, services, buy now, realms to riches">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="canonical" href="https://realmstoriches.github.io/checkout.html">
    <meta property="og:title" content="Secure Checkout - Realms to Riches">
    <meta property="og:description" content="Complete your secure payment for products and services from Realms to Riches.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://realmstoriches.github.io/checkout.html">
    <meta property="og:image" content="https://realmstoriches.github.io/img/checkout-banner.jpg"> <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Secure Checkout - Realms to Riches">
    <meta name="twitter:description" content="Complete your secure payment for products and services from Realms to Riches.">
    <meta name="twitter:image" content="https://realmstoriches.github.io/img/checkout-banner.jpg"> <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <div id="main-popup-container" class="popup-overlay">
        <div id="cookie-consent-content" class="popup-content">
            <h2>Cookie Consent</h2>
            <p>We use cookies to ensure you get the best experience on our website. By continuing, you agree to our use of cookies.</p>
            <div>
                <a href="/privacy-policy.html" class="cookie-link">Learn More</a>
                <button id="accept-cookies" class="btn btn-secondary" type="button">Accept</button>
            </div>
        </div>
        <div id="lead-capture-content" class="popup-content">
            <button id="close-lead-form" class="close-button" type="button">×</button>
            <img src="img/ampcast-popup-offer.webp" alt="Exclusive AmpCast Launch Offer" style="max-width: 80%; height: auto; margin-bottom: 15px; border-radius: 4px;">
            <h2>AmpCast Launch Special: Scale Your Content & Traffic!</h2>
            <p>Unlock cutting-edge strategies to maximize your AmpCast content amplification and drive massive organic traffic. Don't miss out!</p>
            <form id="lead-capture-form" action="https://formspree.io/f/xvgajnqr" method="POST">
                <div class="form-group">
                    <label for="email">Your email:</label>
                    <input type="email" id="email" name="email" placeholder="Your Email" required>
                </div>
                <div class="form-group">
                    <label for="name">Your name (optional):</label>
                    <input type="text" id="name" name="name" placeholder="Your Name">
                </div>
                <button type="submit">Get Exclusive Insights</button>
            </form>
            <div id="form-message"></div> <p class="mt-3"><a href="/ampcast.html" class="btn btn-secondary-outline">Learn More About AmpCast Benefits Here &raquo;</a></p>
        </div>
    </div>

    <header class="site-header">
        <div class="container header-container">
            <div class="logo-area">
                <a href="/">
                    <img src="img/logo.webp" alt="Realms to Riches Logo" class="site-logo" width="50" height="50">
                </a>
            </div>
            <nav class="main-navigation">
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/courses.html">Free Courses</a></li>
                    <li><a href="/tools.html">Recommended Tools</a></li>
                    <li><a href="/shopify-offer.html">Shopify Offer</a></li>
                    <li><a href="/services.html">Our Services</a></li>
                    <li><a href="/ampcast.html">Traffic Solutions</a></li>
                    <li>
                        <a href="/view-cart.html" id="cart-link" aria-label="View Shopping Cart">
                            <i class="fas fa-shopping-cart cart-icon"></i>
                            <span id="cart-count" class="cart-count-badge">0</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="checkout-page-main">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-8 col-md-10">
                    <h1 class="text-center mb-4">Your Order Summary</h1>
                    <div class="product-summary text-center mb-4">
                        <p>Your Cart Total: $<span id="cart-total-price">0.00</span></p>
                    </div>

                    <div class="checkout-form-container area"> <h2>Payment Details</h2>

                        <form id="payment-form">
                            <div class="form-group mb-3">
                                <label for="customer-name">Full Name:</label>
                                <input type="text" id="customer-name" name="customer-name" placeholder="John Doe" required>
                            </div>
                            <div class="form-group mb-3">
                                <label for="customer-email">Email Address:</label>
                                <input type="email" id="customer-email" name="customer-email" placeholder="john.doe@example.com" required>
                            </div>

                            <hr>
                            <div class="form-group mb-4">
                                <label for="payment-element">Credit or debit card / Other payment options</label>
                                <div id="payment-element">
                                    </div>
                                <div id="error-message" class="error-message" style="display: none;"></div>
                            </div>

                            <div class="payment-buttons-container">
                                <button id="submit-payment-btn" class="btn btn-primary">
                                    <div class="loading-spinner hidden" id="spinner">
                                        <i class="fas fa-dollar-sign"></i> </div>
                                    <span id="button-text">Pay Now</span>
                                </button>
                                <button id="cancel-payment-btn" type="button" class="btn btn-secondary">Cancel</button>
                            </div>
                        </form>

                        <div id="payment-success-message" class="success-message" style="display: none;">
                            <p>Thank you! Your payment was successful.</p>
                            <p>A confirmation email has been sent to your address.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="footer-legal">
        <p class="disclaimer">
            <strong>Affiliate Disclaimer:</strong> This site may contain affiliate links. We may receive a commission if you sign up through these links, at no extra cost to you. This helps support our free content and resources.
        </p>
    </div>

    <footer class="site-footer">
        <div class="container footer-container">
            <div class="footer-info">
                <p>© Realms to Riches Copyright 2025</p>
                <p>CEO: Robert Demotto Jr</p>
                <p>Mill Creek, WV 26280</p>
                <p><a href="mailto:realmstoriches@gmail.com">realmstoriches@gmail.com</a></p>
                <p><a href="tel:304-266-4833">304-266-4833</a></p>
            </div>
            <div class="footer-legal">
                <p><a href="/terms-of-service.html" class="footer-link">Terms of Service</a></p>
                <p><a href="/privacy-policy.html" class="footer-link">Privacy Policy</a></p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // --- Stripe Payment Element Integration (Needs Server-Side) ---
        const stripe = Stripe('YOUR_STRIPE_PUBLISHABLE_KEY'); // REPLACE WITH YOUR ACTUAL PUBLISHABLE KEY
        let elements;
        let clientSecret;

        // Function to fetch client secret (You NEED a server-side endpoint for this)
        async function initializeStripePayment() {
            try {
                // Fetch client secret from your backend.
                // This 'create-payment-intent' endpoint would calculate the total based on cart items
                // and create a PaymentIntent on your Stripe account.
                const response = await fetch('/create-payment-intent', { // REPLACE with your actual backend endpoint
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ items: JSON.parse(localStorage.getItem('cart')) || [] }), // Send cart items to backend
                });
                const { clientSecret: newClientSecret } = await response.json();
                clientSecret = newClientSecret;

                if (!clientSecret) {
                    throw new Error('Failed to fetch client secret.');
                }

                elements = stripe.elements({ clientSecret });
                const paymentElement = elements.create('payment', {
                    layout: 'tabs' // 'tabs' or 'accordion' can help with space if multiple options
                });
                paymentElement.mount('#payment-element');

                // Optional: Listen for changes on payment element to show/hide errors
                paymentElement.on('change', function(event) {
                    const displayError = document.getElementById('error-message');
                    if (event.error) {
                        displayError.textContent = event.error.message;
                        displayError.style.display = 'block';
                    } else {
                        displayError.textContent = '';
                        displayError.style.display = 'none';
                    }
                });

            } catch (error) {
                console.error('Error initializing Stripe Payment:', error);
                const errorMessage = document.getElementById('error-message');
                errorMessage.textContent = 'Unable to load payment options. Please try again later.';
                errorMessage.style.display = 'block';
            }
        }

        // --- Loading Spinner Logic ---
        const spinner = document.getElementById('spinner');
        const buttonText = document.getElementById('button-text');
        const submitButton = document.getElementById('submit-payment-btn');

        function showSpinner() {
            spinner.classList.remove('hidden');
            buttonText.classList.add('hidden');
            submitButton.disabled = true; // Disable button during processing
        }

        function hideSpinner() {
            spinner.classList.add('hidden');
            buttonText.classList.remove('hidden');
            submitButton.disabled = false; // Re-enable button
        }

        // --- Form Submission Handler ---
        document.getElementById('payment-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            showSpinner(); // Show spinner on submit

            const customerName = document.getElementById('customer-name').value;
            const customerEmail = document.getElementById('customer-email').value;

            const { error } = await stripe.confirmPayment({
                elements,
                confirmParams: {
                    // Make sure to change this to your actual success page URL
                    return_url: `${window.location.origin}/success.html`,
                    payment_method_data: {
                        billing_details: {
                            name: customerName,
                            email: customerEmail,
                        },
                    },
                },
                redirect: 'if_required', // Only redirect if necessary (e.g., for 3D Secure)
            });

            if (error) {
                const errorMessage = document.getElementById('error-message');
                errorMessage.textContent = error.message;
                errorMessage.style.display = 'block';
                hideSpinner(); // Hide spinner if there's an error
            } else {
                // Payment succeeded, but no redirect happened (e.g., if using redirect: 'if_required')
                // Handle success directly, or ensure your server-side confirms success and redirects
                console.log('Payment succeeded or awaiting further action by Stripe.');
                // For a robust implementation, your server should confirm the PaymentIntent status.
                // For this example, we'll redirect immediately if no error.
                window.location.href = '/success.html'; // Direct client-side redirect
            }
        });

        // --- Cancel Button Logic ---
        document.getElementById('cancel-payment-btn').addEventListener('click', () => {
            window.location.href = '/cancel.html';
        });

        // --- Cart Total Display ---
        function updateCartTotalPrice() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('cart-total-price').textContent = totalPrice.toFixed(2);
        }

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeStripePayment(); // Initialize Stripe when the DOM is ready
            updateCartTotalPrice(); // Update cart total
        });
    </script>
</body>
</html>
